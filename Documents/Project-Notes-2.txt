======================================
2D Survival Game Notes
======================================

Source:
https://www.udemy.com/course/unreal-engine-5-create-a-top-down-2d-survivors-style-game

=====================================================================
Section 3: Pooling Framework (Bullets, Items, Mobs)
=====================================================================

=====================================================================
11. Pooling Bullets Part 1
12. Pooling Bullets Part 2

------------------------------
Object Pooling Overview

Objects to Pool
* Bullets
* Mobs
* Pickable Items

BPA_LevelManager
1. Monitor active existing instances
2. Spawn bullets/mobs/pickable items
3. Reuse existing and Inactive instances

States of Pooling Instance
* In Pool (Inactive)
* In Use (Active)
------------------------------
GI_SG
* Survival Game Game Instance
* Really should name this BP_SGGameInstance

Change GameInstance Class:
* Project Settings -> Project -> Maps & Modes -> Game Instance -> Game Instance Class
* This is initialized automatically when the game is started

Blueprint Function Library:
* I named this BPFL_SG, as per some standard naming conventions
* Added function GetSGGameInstance
  * Call GetGameInstance and then Cast to GI_SG.
  * Right-click -> Convert to Pure Cast 
    * A Pure cast assumes you have the correct object input and has no handlers if the cast fails.
    * Only use a pure cast when you are certain that the correct object is being casted
      * For example, as above, GetGameInstance -> Cast to 

------------------------------
Naming Convention:

"L_" for "local variable", e.g. L_AvailableBullet

In the BPA_LevelManager, in function PoolingBullet, we added a "LifeSpan" input parameter.
However, there already is a UE variable named LifeSpan, so this is not a good name, but we will keep it for now.

------------------------------
For the Sphere and Collision volumes in the bullet actor (BPA_Bullet):
We turned off collision while the bullet is in the pool
We turn the collision back on while the bullet is active.
We did this in the Collision Responses.
The only Collision response we wanted while active is Pawn.
Use Node:
* Set Collision Response to Channel
  * Channel: Pawn
  * New Response: Overlap

=====================================================================

13. Combat Interface

Created Blueprint Interface:
BPI_Combat

BP_AI now implements this Interface
* Implement a Blueprint Interface:
  * Class Settings -> Details -> Implemented Interfaces -> Add 
* Implement BPI functions: Double click in the MyBlueprint window

Handling Knockback:
* Added function: HandleKnockbackAndColor
* MovementComponent:  Call Node: StopMovementImmediately
* Character: Call Node: LaunchCharacter
  * We checked XYOverride and ZOverride
    * This means to REPLACE the character velocity instead of adding to it
* Note: In a Function, we cannot call the Delay Node, so we use SetTimer


Function for getting a direction from one position to another:
GetUnitDirection
* From 
* To

KismetMathLibrary.inl:

KISMET_MATH_INLINE
FVector UKismetMathLibrary::GetDirectionUnitVector(FVector From, FVector To)
{
  return (To - From).GetSafeNormal();
}


NOTE - POTENTIAL BUG
* The enemy is not getting knocked back, regardless of the AppliedForce.
* We raise the enemy so its collision sphere is above the floor (and not intersecting with it) 

"That's because in Unreal Engine 5.3 I think there is a small bug here."
"When capsule is completely snap to the blocking volume, it is stuck."

Changes:
* Moved character height to 22 (so collision is above floor)
* LaunchCharacter - ZOverride FALSE (I made this change, but not sure it does anything))
* BP_AI -> CharMoveComp-> Falling Lateral Friction: 2 (I made this change, but not sure it does anything). This was 0 originally.
* NOTE: We changed Force to 0 in the end.

NOTE:
* The AI's Capsule Component is set to "Block" on WorldStatic. I will look into that too.
  * The TM_Floor has CollisionPreset set to "BlockAll"
  * NOTE: When I set the AI's collision to Overlap, it no longer collided with the floor and knockback worked.

=====================================================================
14. Add Sound Management

Sound Source:
https://mixkit.co/free-sound-effects/woosh/
* Dagger Woosh

Import the Sound
Create a Sound Cue:
Right-click -> Create Cue
* This creates a Sound Cue asset

Create Sound Cue:
He called it Cue_Hit
Using the "standard" naming conventions:
* Sound Cue -- Prefix: A_  Suffix: _Cue  
I am going with:
* A_Hit_Cue

Sound Cue:
* In UE5, you can use WAV files directly, but it is better to use Audio Cues as they give you more control
* Modulator - can change Pitch and Volume
  * Pitch Min / Max: 1.8, 2.2
* Output Node:
  * Volume Multiplier: Set to 0.55
* You need to create a Sound Class in order to adjust sound Volume during the game:

Right-click -> Audio -> Classes -> Sound Class
* Note: SC_ belongs to "Sound Concurrency"
* In naming guide:
  * Sound Class      No prefix/suffix. Should be put in a folder called SoundClasses
* He named the class SC_SFX
* I named it SFXSoundClass

Right-click -> Audio -> Classes -> Sound Class Mix
* SoundClassMix is a class that can manage other sounds
* SGSoundClassMix
* Mix_SG
  * He named it SCM_SG
* In the SoundMix, under Sound Classes -> Sound Class Effects
  * Add your Sound Classes there

Game Instance:
* Event Init:
  * Set Base Sound Mix: Mix_SG
  * Set Sound Mix Class Override: Mix_SG
    * InSoundMixModifier:  Mix_SG
    * InSoundClass: SFXSoundClass
  * Set Sound Mix Class Override: Mix_SG
    * InSoundMixModifier:  Mix_SG
    * InSoundClass: BGMSoundClass

Note: I do not know what the above did...

Still in GameInstance (GI_SG):
* Added function HitSound:
  * SpawnSound2D: A_Hit_Cue
  * Added variable HitSoundVar from return of SpawnSound2D
  * We only "Spawn" the sound ONCE. We keep a reference to it and play that

=====================================================================
15. Apply Damage to Enemies

Adding Asset Pack:
Interface & Item Sounds Pack
https://www.unrealengine.com/marketplace/en-US/product/interface-item-sounds-pack

Copied
Futuristic_Click_05_Cue.uasset
C:/Dev/Udemy/SurvivalGame2D/Content/Interface_And_Item_Sounds/Cues/Futuristic_Click_05_Cue.uasset

to SFX and renamed to:
A_PlayerHit_Cue
* Class: SFXSoundClass


----------------------
Set Player Dead
* Replication: REP_NOTIFY
* While we are not doing networking, we can still utilize the OnRep_Dead function that is created.

Enemy AI On Collision Begin Overlap:
* Added Set Timer by Event
* Drag from left red square to create an event
  * TouchDamage Event

Enemy AI On Collision End Overlap
* Clear and Invalidate Timer by Handle

=====================================================================
